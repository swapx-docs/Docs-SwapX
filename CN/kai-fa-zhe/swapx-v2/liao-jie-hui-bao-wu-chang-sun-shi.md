# 💰 了解回报（无常损失）

### 💰 了解回报（无常损失）

SwapX 激励用户向交易池增加流动性，方法是向提供商奖励其他用户与这些池交易时产生的费用。

注意： 做市通常是一项复杂的活动。与单纯持有资产（HODL）相比，在基础资产价格大幅且持续波动期间存在亏损的风险。

***

#### 💧 流动性提供示例

我们来看一个关于流动性提供和回报计算的具体例子。

| **事件** | **流动性提供者 (LP) 操作**                       | **资金池状态**                                      | **LP 份额** |
| ------ | ---------------------------------------- | ---------------------------------------------- | --------- |
| 初始状态   | LP 添加 10,000 DAI 和 100 WETH（总价值：$20,000） | 总池子： 100,000 DAI 和 1,000 WETH                  | 10% 的总流动性 |
|        | 合约铸造并向 LP 发送“流动性代币”，使其有权获得池子里 10% 的流动性。  | _注意：这些代币不可交易、不具投机性，只是一种会计或簿记工具，用于跟踪 LP 应得的金额。_ |           |

如果随后有其他人添加/提取代币，则会铸造/销毁新的流动性代币，以使每个 LP 在流动性池中的相对百分比份额保持不变。

#### 📉 价格变化的影响

现在，我们假设外部市场（Coinbase）上的价格从每 WETH 100 美元涨至 150 美元。

1. 套利： 经过一些套利后，SwapX 合约也应该反映出这一变化。交易者将添加 DAI 并移除 WETH，直到新的比率变为 150:1。
2. 新的资金池状态： 合约反映的数字接近 122,400 DAI 和 817 WETH。
   * _检查：_ $$ $122,400 \times 817 \approx 100,000,000$ $$（我们的恒定乘积）和 $$ $122,400 / 817 \approx 150$ $$（我们的新价格）。
3. LP 提取： LP 有权获得的 10% 现在将产生 12,240 DAI 和 81.7 WETH。
   * 总市场价值： 约 $24,500。
4. HODL 价值： 如果 LP 只是持有他们最初的 10,000 DAI 和 100 WETH，总价值将是：$$ $10,000 + (100 \times \$150) = \$25,000$ $$。
5. 做市造成的损失： 与 HODLing 相比，LP 大约损失了价值 $500 的潜在利润。

***

#### 🎁 赚取交易费用

显然，没有人会出于慈善目的提供流动性。

相反，所有交易量的 0.3% 按比例分配给所有流动性提供者。

* 默认情况下，这些费用会放回流动性池中，但可以随时收取。
* 总回报取决于费用收入和方向性价格变动造成的损失之间的权衡。
* 来回波动越多（即交易越多），对 LP 越有利。

***

#### ❓ 我的流动资金价值为何低于我投入的金额？

要理解为什么流动性提供者的股份价值尽管有费用收入却会下降，我们需要更仔细地研究 SwapX 用于管理交易的公式。

1\. 恒定乘积公式（忽略费用）：

\$$\text{eth\\\_liquidity\\\_pool} \times \text{token\\\_liquidity\\\_pool} = \text{constant\\\_product}\$$

2\. 价格关系：

对于价值与流动性池规模相比非常小的交易，我们有：

\$$\text{eth\\\_price} \approx \frac{\text{token\\\_liquidity\\\_pool\}}{\text{eth\\\_liquidity\\\_pool\}}\$$

3\. 任意价格下的池规模：

结合这两个等式，我们可以计算出每个流动性池在任意给定价格下的规模（假设总流动性保持不变）：

\$$\text{eth\\\_liquidity\\\_pool} = \sqrt{\frac{\text{constant\\\_product\}}{\text{eth\\\_price\}}}\$$\$$\text{token\\\_liquidity\\\_pool} = \sqrt{\text{constant\\\_product} \times \text{eth\\\_price\}}\$$

#### 🌊 无常损失 (Impermanent Loss) 解释

让我们看看价格变化对流动性提供者份额的影响。

| **场景** | **细节**                                                        |
| ------ | ------------------------------------------------------------- |
| 初始投入   | LP 提供 1 XOC 和 100 DAI (占总池 1% 的份额，总池包含 100 XOC 和 10,000 DAI)。 |
| 初始价格   | 1 XOC = 100 DAI。                                              |
| 新价格    | 1 XOC = 120 DAI (1.2 倍的变化)。                                   |

**损失计算：**

1. 新的池准备金（使用公式）：
   * $$ $\text{eth\_liquidity\_pool} \approx 91.2871$ $$ (XOC)
   * $$ $\text{dai\_liquidity\_pool} \approx 10,954.4511$ $$ (DAI)
2. LP 的新份额 (1%)： $$ $0.9129$ $$ XOC 和 $$ $109.54$ $$ DAI。
3. LP 份额的当前价值（转换为 DAI）： $$ $(0.9129 \times 120) + 109.54 \approx 219.09$ $$ DAI。
4. HODL 价值： 如果 LP 只是持有最初的 $$ $1$ $$ XOC 和 $$ $100$ $$ DAI，按新价格计算，总价值将是 $$ $(1 \times 120) + 100 = 220$ $$ DAI。
5. 无常损失： LP 通过提供流动性而不是 HODLing 损失了 $$ $\approx 0.91$ $$ DAI。

这种损失被称为无常损失 (Impermanent Loss)，因为它会在价格回到 LP 增加流动性时的价格时消失。

#### 📏 无常损失公式

我们可以得出一个公式，根据流动性供应时和现在的价格比率来计算无常损失的大小：

\$$\text{impermanent\\\_loss} = \frac{2 \times \sqrt{\text{price\\\_ratio\}}}{1 + \text{price\\\_ratio\}} - 1\$$

| **价格变化（比率）** | **相对于 HODL 的损失** |
| ------------ | ---------------- |
| 1.25 倍       | 0.6% 损失          |
| 1.50 倍       | 2.0% 损失          |
| 1.75 倍       | 3.8% 损失          |
| 2 倍（价格翻倍或减半） | 5.7% 损失          |
| 3 倍          | 13.4% 损失         |
| 4 倍          | 20.0% 损失         |
| 5 倍          | 25.5% 损失         |

> 关键注意： 无论价格朝哪个方向变化，损失都是相同的（即价格翻倍与减半造成的损失相同）。
